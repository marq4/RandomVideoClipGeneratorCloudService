<!DOCTYPE html>
<html>
<head>
  <title>Random Video Clip Generator</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://unpkg.com/vue@1.0.28/dist/vue.js"></script>
  <script src="https://unpkg.com/axios@0.2.1/dist/axios.min.js"></script>
</head>
<body>
  <h1>Random Video Clip Generator</h1>
  <div class="info">
    <h2>Instructions (Windows):</h2>
    <ol>
      <li>Install <a href="https://www.youtube.com/watch?v=DMEP82yrs5g">FFMPEG</a>.</li>
      <li>Install <a href="https://www.videolan.org/vlc/">VLC</a>.</li>
      <li>Create folder structure on your computer: <code>C:\Videos\videos</code></li>
      <li>Download some music videos there (contact me for instructions: <a href="mailto:juancmarquina@gmail.com">juancmarquina@gmail.com</a>).</li>
      <li>Download the <a href="https://rvcg-marq-30072025.s3.us-east-2.amazonaws.com/GenerateList.ps1">PoweShell script</a>.</li>
      <li>Move it to <code>C:\Videos</code> folder.</li>
      <li>Run it:</li>
	<ol>
	  <li>Open an elevated PowerShell window by pressing <code>WIN+X</code> and selecting Windows PowerShell (Admin).</li>
	  <li>Change-directory into your Videos folder: <code>cd C:\Videos</code></li>
	  <li>Execute the script: <code>powershell.exe -executionpolicy bypass -File .\GenerateList.ps1</code></li>
	  <li>Contact me if you don't see this: <code>Script complete.</code></li>
	</ol>
      <li>Upload <code>list_videos.txt</code> bellow (Browse + Upload).</li>
      <li>After uploading your list of videos, click the <code>Generate &amp; Download Playlist</code> button.</li>
      <li>When you double-click the downloaded playlist, your video clips will appear on VLC media player. Press <code>f</code> key to toggle full-screen.</li>
    </ol>
  </div>

  <div id="app" class="upload-form">
    <div v-if="!textFile">
      <h2 class="label">Select video list text file</h2>
      <input type="file" @change="onFileChange" accept="text/plain" />
    </div>
    <div v-else>
      <button v-if="!uploadURL" @click="uploadFile" class="actual-button">
        Upload
      </button>
    </div>
  </div>
  
  <script>
    const MAX_LIST_SIZE = 5000000
    const API_ENDPOINT = 'https://9xd9orynnk.execute-api.us-east-2.amazonaws.com/uploads'
    new Vue({
          el: "#app",
          data: {
                textFile: '',
                uploadURL: ''
          },
          methods: {
                onFileChange(e) {
                      let files = e.target.files || e.dataTransfer.files
                      if (!files.length) return
                      this.loadTextFile(files[0])
                },
                loadTextFile(file) {
                      let reader = new FileReader()
                      reader.onload = (e) => {
                            // Store the file content (string) directly
                            this.textFile = e.target.result
                      }
                      reader.readAsText(file)  // Read as plain text instead of DataURL
                },
                uploadFile: async function () {
                      console.log('Upload clicked')

                      // Get the presigned URL from backend
                      const response = await axios({
                            method: 'GET',
                            url: API_ENDPOINT
                      })
                      console.log('Response: ', response)

                      // Convert text content to Blob
                      let blobData = new Blob([this.textFile], { type: 'text/plain' })

                      console.log('Uploading to: ', response.uploadURL)
                      const result = await fetch(response.uploadURL, {
                            method: 'PUT',
                            body: blobData
                      })
                      console.log('Result: ', result)

                      // Final URL (strip query string)
                      this.uploadURL = response.uploadURL.split('?')[0]

                      // Extract just the object key:
                      const objectKey = this.uploadURL.substring(this.uploadURL.lastIndexOf('/') + 1)

                      // Take user to playlist generation page:
                      window.location.href = `https://randomvideoclipgenerator.com/generate_playlist.html?file=${encodeURIComponent(objectKey)}`
                }
          }
    })
  </script>

</body>
</html>

